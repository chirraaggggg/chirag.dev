import{jsx as e}from"react/jsx-runtime";import{defaultTranslationConfig as t}from"c15t";import{expect as o,test as n,vi as s}from"vitest";import{ConsentManagerWidget as r}from"../consent-manager-widget.js";import a from"../../../utils/test-helpers.js";import c from"../consent-manager-widget.module.js";s.mock("~/hooks/use-consent-manager",()=>({useConsentManager:s.fn().mockReturnValue({getConsentCategory:s.fn().mockReturnValue({isEnabled:!0}),updateConsentCategory:s.fn(),saveConsents:s.fn(),getDisplayedConsents:s.fn().mockReturnValue([]),translationConfig:{defaultLanguage:"en"}})})),s.mock("~/hooks/use-translations",()=>({useTranslations:s.fn().mockReturnValue(t.translations.en)}));let d=[{testId:"consent-manager-widget-root",themeKey:"widget.root",styles:"custom-root"},{testId:"consent-manager-widget-footer",themeKey:"widget.footer",styles:"custom-footer"},{testId:"consent-manager-widget-footer-sub-group",themeKey:"widget.footer.sub-group",styles:"custom-footer-sub-group"},{testId:"consent-manager-widget-reject-button",themeKey:"widget.footer.reject-button",styles:"custom-reject-button"},{testId:"consent-manager-widget-footer-accept-button",themeKey:"widget.footer.accept-button",styles:"custom-accept-button"},{testId:"consent-manager-widget-footer-save-button",themeKey:"widget.footer.save-button",styles:"custom-save-button"},{testId:"consent-manager-widget-accordion-trigger-marketing",themeKey:"widget.accordion.trigger",styles:"custom-accordion-trigger"},{testId:"consent-manager-widget-accordion-trigger-inner-marketing",themeKey:"widget.accordion.trigger-inner",styles:"custom-accordion-trigger-inner"},{testId:"consent-manager-widget-accordion-content-marketing",themeKey:"widget.accordion.content",styles:"custom-accordion-content"},{testId:"consent-manager-widget-switch-marketing",themeKey:"widget.switch",styles:"custom-switch"}];n("should apply string classNames from theme prop to all widget elements",async()=>{let t=e(r,{theme:d.reduce((e,{themeKey:t,styles:o})=>(e[t]=o,e),{})});await a({component:t,testCases:d.map(({testId:e,styles:t})=>({testId:e,styles:t}))})}),n("should apply className and style objects from theme prop to all widget elements",async()=>{let t={backgroundColor:"#ffffff",padding:"20px",border:"1px solid #000000"},o=d.map(({testId:e,themeKey:o,styles:n})=>({testId:e,themeKey:o,className:n,style:t})),n=e(r,{theme:o.reduce((e,{themeKey:t,className:o,style:n})=>(e[t]={className:o,style:n},e),{})});await a({component:n,testCases:o.map(({testId:e,className:t,style:o})=>({testId:e,styles:{className:t,style:o}}))})}),n("should remove default styles but keep custom classNames when top-level noStyle prop is true",async()=>{let t=e(r,{noStyle:!0,theme:d.reduce((e,{themeKey:t,styles:o})=>(e[t]=o,e),{})});await a({component:t,testCases:d.map(({testId:e,styles:t})=>({testId:e,styles:t})),noStyle:!0})}),n("should remove default styles but keep custom classNames when theme object provides noStyle: true",async()=>{let t=e(r,{theme:d.reduce((e,{themeKey:t,styles:o})=>(e[t]={className:o,noStyle:!0},e),{})});await a({component:t,testCases:d.map(({testId:e,styles:t})=>({testId:e,styles:{className:t}}))})}),n("should correctly apply styles when theme prop uses mixed string and object formats",async()=>{let t=e(r,{theme:{"widget.root":{className:"custom-root",style:{backgroundColor:"rgb(255, 255, 255)",padding:"16px"}},"widget.accordion.trigger":"custom-accordion-trigger"}});await a({component:t,testCases:[{testId:"consent-manager-widget-root",styles:{className:"custom-root",style:{backgroundColor:"rgb(255, 255, 255)",padding:"16px"}}},{testId:"consent-manager-widget-accordion-trigger-marketing",styles:"custom-accordion-trigger"}]})}),n("should handle empty strings and empty style objects in theme prop gracefully",async()=>{let t=e(r,{theme:{"widget.root":"","widget.accordion":"","widget.footer":{className:"",style:{margin:"0",padding:"0"}}}});await a({component:t,testCases:[{testId:"consent-manager-widget-root",styles:""},{testId:"consent-manager-widget-accordion",styles:""},{testId:"consent-manager-widget-footer",styles:{className:"",style:{margin:"0",padding:"0"}}}]})}),n("Custom classes override base layer styles",async()=>{let t=document.createElement("style");t.textContent=`
		.custom-widget-background {
			background-color: rgb(255, 0, 0) !important;
		}
		.custom-widget-foooter {
			color: rgb(0, 255, 0) !important;
		}
	`,document.head.appendChild(t);let n=e(r,{theme:{"widget.root":"custom-widget-background","widget.footer":"custom-widget-foooter"}});await a({component:n,testCases:[{testId:"consent-manager-widget-root",styles:"custom-widget-background"},{testId:"consent-manager-widget-footer",styles:"custom-widget-foooter"}]});let s=document.querySelector('[data-testid="consent-manager-widget-root"]'),c=document.querySelector('[data-testid="consent-manager-widget-footer"]');if(!s||!c)throw Error("Required elements not found in the document");o(getComputedStyle(s).backgroundColor).toBe("rgb(255, 0, 0)"),o(getComputedStyle(c).color).toBe("rgb(0, 255, 0)"),document.head.removeChild(t)}),n("Base layer styles are applied when no custom classes are provided",async()=>{await a({component:e(r,{}),testCases:[]});let t=document.querySelector('[data-testid="consent-manager-widget-root"]'),n=document.querySelector('[data-testid="consent-manager-widget-footer"]');if(!t||!n)throw Error("Required elements not found in the document");o(getComputedStyle(t).backgroundColor).toBe("rgba(0, 0, 0, 0)"),o(getComputedStyle(n).color).toBe("rgb(0, 0, 0)")}),n("Multiple custom classes can be applied and override base layer",async()=>{let t=document.createElement("style");t.textContent=`
		.custom-padding {
			padding: 32px !important;
		}
		.custom-border {
			border: 2px solid rgb(0, 0, 255) !important;
		}
	`,document.head.appendChild(t);let n=e(r,{theme:{"widget.root":"custom-padding custom-border"}});await a({component:n,testCases:[{testId:"consent-manager-widget-root",styles:"custom-padding custom-border"}]});let s=document.querySelector('[data-testid="consent-manager-widget-root"]');if(!s)throw Error("Required elements not found in the document");o(getComputedStyle(s).padding).toBe("32px"),o(getComputedStyle(s).border).toBe("2px solid rgb(0, 0, 255)"),document.head.removeChild(t)}),n("All consent manager widget components should have their base classes applied",async()=>{let t=e(r,{}),n={card:c.card||"",header:c.header||"",title:c.title||"",description:c.description||"",content:c.content||"",footer:c.footer||"",footerGroup:c.footerGroup||"",accordionItem:c.accordionItem||"",accordionTrigger:c.accordionTrigger||"",accordionTriggerInner:c.accordionTriggerInner||"",accordionContent:c.accordionContent||"",accordionArrow:c.accordionArrow||"",switch:c.switch||""};for(let[e,s]of(await a({component:t,testCases:[{testId:"consent-manager-widget-footer",styles:n.footer},{testId:"consent-manager-widget-footer-sub-group",styles:n.footerGroup},{testId:"consent-manager-widget-accordion-trigger-marketing",styles:n.accordionTrigger},{testId:"consent-manager-widget-accordion-trigger-inner-marketing",styles:n.accordionTriggerInner},{testId:"consent-manager-widget-accordion-content-marketing",styles:n.accordionContent},{testId:"consent-manager-widget-switch-marketing",styles:n.switch}]}),Object.entries(n)))o(s,`Base class for ${e} should not be empty`).not.toBe("")});