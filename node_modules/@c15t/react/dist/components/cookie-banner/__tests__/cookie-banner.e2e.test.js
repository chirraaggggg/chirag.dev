let e;import{jsx as t,jsxs as o}from"react/jsx-runtime";import{beforeEach as n,describe as c,expect as a,test as r,vi as s}from"vitest";import{render as i}from"vitest-browser-react";import{ConsentManagerDialog as u}from"../../consent-manager-dialog/consent-manager-dialog.js";import{ConsentManagerProvider as l,clearConsentManagerCache as d}from"../../../providers/consent-manager-provider.js";import{CookieBanner as m}from"../cookie-banner.js";let b=!0,y=!1;s.mock("~/hooks/use-consent-manager",async e=>{let t=await e();return{useConsentManager:()=>({...t.useConsentManager(),showPopup:b,isPrivacyDialogOpen:y,setShowPopup:e=>{b=e},setIsPrivacyDialogOpen:e=>{y=e}})}}),Object.defineProperty(window,"localStorage",{value:(e={},{getItem:t=>e[t]||null,setItem:(t,o)=>{e[t]=o.toString()},removeItem:t=>{delete e[t]},clear:()=>{e={}}})});let h={mode:"offline"};c("CookieBanner E2E Tests",()=>{n(()=>{window.localStorage.clear(),b=!0,s.clearAllMocks(),d()}),r("should show cookie banner on first visit",async()=>{i(o(l,{options:h,children:[t(m,{}),t(u,{})]})),a(document.body.querySelector('[data-testid="cookie-banner-root"]')).toBeInTheDocument(),a(b).toBe(!0),a(document.querySelector('[data-testid="cookie-banner-title"]')).toBeInTheDocument(),a(document.querySelector('[data-testid="cookie-banner-description"]')).toBeInTheDocument(),a(document.querySelector('[data-testid="cookie-banner-reject-button"]')).toBeInTheDocument(),a(document.querySelector('[data-testid="cookie-banner-customize-button"]')).toBeInTheDocument(),a(document.querySelector('[data-testid="cookie-banner-accept-button"]')).toBeInTheDocument()}),r("should accept all cookies when clicking Accept All",async()=>{i(o(l,{options:h,children:[t(m,{}),t(u,{})]}));let e=document.querySelector('[data-testid="cookie-banner-accept-button"]');e?.dispatchEvent(new MouseEvent("click",{bubbles:!0})),await new Promise(e=>setTimeout(e,100)),a(b).toBe(!1),a(document.querySelector('[data-testid="cookie-banner-root"]')).not.toBeInTheDocument();let n=JSON.parse(window.localStorage.getItem("c15t")||"{}");a(n.consents.necessary).toBeTruthy(),a(n.consents.marketing).toBeTruthy(),a(n.consents.experience).toBeFalsy()}),r("should reject non-essential cookies when clicking Reject All",async()=>{i(o(l,{options:h,children:[t(m,{}),t(u,{})]}));let e=document.querySelector('[data-testid="cookie-banner-reject-button"]');e?.dispatchEvent(new MouseEvent("click",{bubbles:!0})),await new Promise(e=>setTimeout(e,100)),a(b).toBe(!1),a(document.querySelector('[data-testid="cookie-banner-root"]')).not.toBeInTheDocument();let n=JSON.parse(window.localStorage.getItem("c15t")||"{}");a(n.consents).toBeTruthy(),a(n.consents.necessary).toBe(!0),a(n.consents.experience).toBe(!1),a(n.consents.functionality).toBe(!1),a(n.consents.marketing).toBe(!1),a(n.consents.measurement).toBe(!1)}),r("should open consent manager dialog when clicking Customize",async()=>{i(o(l,{options:h,children:[t(m,{}),t(u,{})]}));let e=document.querySelector('[data-testid="cookie-banner-customize-button"]');e?.dispatchEvent(new MouseEvent("click",{bubbles:!0})),await new Promise(e=>setTimeout(e,100)),a(b).toBe(!1),a(document.querySelector('[data-testid="cookie-banner-root"]')).not.toBeInTheDocument(),a(y).toBe(!0),a(document.querySelector('[data-testid="consent-manager-dialog-root"]')).toBeInTheDocument(),a(document.querySelector('[data-testid="consent-manager-widget-switch-necessary"]')).toBeInTheDocument(),a(document.querySelector('[data-testid="consent-manager-widget-switch-marketing"]')).toBeInTheDocument();let n=document.querySelector('[data-testid="consent-manager-widget-switch-marketing"]');n?.dispatchEvent(new MouseEvent("click",{bubbles:!0}));let c=document.querySelector('[data-testid="consent-manager-widget-footer-save-button"]');c?.dispatchEvent(new MouseEvent("click",{bubbles:!0})),await new Promise(e=>setTimeout(e,100)),a(y).toBe(!1);let r=JSON.parse(window.localStorage.getItem("c15t")||"{}");a(r.consents).toBeTruthy(),a(r.consents.marketing).toBe(!0),a(r.consents.functionality).toBeFalsy()}),r("should be keyboard accessible",async()=>{i(o(l,{options:h,children:[t(m,{}),t(u,{})]}));let e=document.querySelector('[data-testid="cookie-banner-reject-button"]'),n=document.querySelector('[data-testid="cookie-banner-customize-button"]'),c=document.querySelector('[data-testid="cookie-banner-accept-button"]');e.focus(),a(document.activeElement).toBe(e),n.focus(),a(document.activeElement).toBe(n),c.focus(),a(document.activeElement).toBe(c)}),r("should handle scroll lock properly",async()=>{i(o(l,{options:h,children:[t(m,{scrollLock:!0}),t(u,{})]})),a(document.querySelector('[data-testid="cookie-banner-overlay"]')).toBeInTheDocument();let e=document.querySelector('[data-testid="cookie-banner-accept-button"]');e?.dispatchEvent(new MouseEvent("click",{bubbles:!0})),await new Promise(e=>setTimeout(e,100)),a(document.querySelector('[data-testid="cookie-banner-overlay"]')).not.toBeInTheDocument()})});