import{jsx as e}from"react/jsx-runtime";import{defaultTranslationConfig as t}from"c15t";import{expect as o,test as s,vi as n}from"vitest";import{CookieBanner as r}from"../cookie-banner.js";import a from"../../../utils/test-helpers.js";import c from"../../shared/ui/button/button.module.js";import l from"../cookie-banner.module.js";n.mock("~/hooks/use-consent-manager",()=>({useConsentManager:()=>({showPopup:!0,translationConfig:{defaultLanguage:"en"},...n.fn()})})),n.mock("~/hooks/use-translations",()=>({useTranslations:()=>t.translations.en})),n.mock("~/hooks/use-text-direction",()=>({useTextDirection:n.fn().mockReturnValue("ltr")}));let d=[{testId:"cookie-banner-root",themeKey:"banner.root",styles:"custom-root"},{testId:"cookie-banner-card",themeKey:"banner.card",styles:"custom-card"},{testId:"cookie-banner-header",themeKey:"banner.header.root",styles:"custom-header"},{testId:"cookie-banner-title",themeKey:"banner.header.title",styles:"custom-title"},{testId:"cookie-banner-description",themeKey:"banner.header.description",styles:"custom-description"},{testId:"cookie-banner-footer",themeKey:"banner.footer",styles:"custom-footer"},{testId:"cookie-banner-footer-sub-group",themeKey:"banner.footer.sub-group",styles:"custom-footer-sub-group"},{testId:"cookie-banner-overlay",themeKey:"banner.overlay",styles:"custom-overlay"},{testId:"cookie-banner-reject-button",themeKey:"banner.footer.reject-button",styles:"custom-reject-button"},{testId:"cookie-banner-customize-button",themeKey:"banner.footer.customize-button",styles:"custom-customize-button"},{testId:"cookie-banner-accept-button",themeKey:"banner.footer.accept-button",styles:"custom-accept-button"}];s("should apply string classNames from theme prop to all banner elements",async()=>{let t=e(r,{scrollLock:!0,theme:d.reduce((e,{themeKey:t,styles:o})=>(e[t]=o,e),{})});await a({component:t,testCases:d.map(({testId:e,styles:t})=>({testId:e,styles:t}))})}),s("should apply className and style objects from theme prop to all banner elements",async()=>{let t={backgroundColor:"#ffffff",padding:"20px",border:"1px solid #000000"},o=d.map(({testId:e,themeKey:o,styles:s})=>({testId:e,themeKey:o,className:s,style:t})),s=e(r,{scrollLock:!0,theme:o.reduce((e,{themeKey:t,className:o,style:s})=>(e[t]={className:o,style:s},e),{})});await a({component:s,testCases:o.map(({testId:e,className:t,style:o})=>({testId:e,styles:{className:t,style:o}}))})}),s("should remove default styles but keep custom classNames when top-level noStyle prop is true",async()=>{let t=e(r,{scrollLock:!0,noStyle:!0,theme:d.reduce((e,{themeKey:t,styles:o})=>(e[t]=o,e),{})});await a({component:t,testCases:d.map(({testId:e,styles:t})=>({testId:e,styles:t})),noStyle:!0})}),s("should remove default styles but keep custom classNames when theme object provides noStyle: true",async()=>{let t=e(r,{scrollLock:!0,theme:d.reduce((e,{themeKey:t,styles:o})=>(e[t]={className:o,noStyle:!0},e),{})});await a({component:t,testCases:d.map(({testId:e,styles:t})=>({testId:e,styles:{className:t}}))})}),s("should correctly apply styles when theme prop uses mixed string and object formats",async()=>{let t=e(r,{scrollLock:!0,theme:{"banner.root":{className:"custom-root",style:{backgroundColor:"rgb(255, 255, 255)",padding:"16px"}},"banner.header.title":"custom-title"}});await a({component:t,testCases:[{testId:"cookie-banner-root",styles:{className:"custom-root",style:{backgroundColor:"rgb(255, 255, 255)",padding:"16px"}}},{testId:"cookie-banner-title",styles:"custom-title"}]})}),s("should handle empty strings and empty style objects in theme prop gracefully",async()=>{let t=e(r,{scrollLock:!0,theme:{"banner.root":"","banner.card":"","banner.header.root":"","banner.header.title":"","banner.header.description":"","banner.footer":{className:"",style:{margin:"0",padding:"0"}}}});await a({component:t,testCases:[{testId:"cookie-banner-root",styles:""},{testId:"cookie-banner-title",styles:""},{testId:"cookie-banner-footer",styles:{className:"",style:{margin:"0",padding:"0"}}}]})}),s("Custom classes override base layer styles",async()=>{let t=document.createElement("style");t.textContent=`
		.custom-banner-background {
			background-color: rgb(255, 0, 0) !important;
		}
		.custom-banner-text {
			color: rgb(0, 255, 0) !important;
		}
	`,document.head.appendChild(t);let s=e(r,{theme:{"banner.card":"custom-banner-background","banner.header.title":"custom-banner-text"}});await a({component:s,testCases:[{testId:"cookie-banner-card",styles:"custom-banner-background"},{testId:"cookie-banner-title",styles:"custom-banner-text"}]});let n=document.querySelector('[data-testid="cookie-banner-card"]'),c=document.querySelector('[data-testid="cookie-banner-title"]');if(!n||!c)throw Error("Required elements not found in the document");o(getComputedStyle(n).backgroundColor).toBe("rgb(255, 0, 0)"),o(getComputedStyle(c).color).toBe("rgb(0, 255, 0)"),document.head.removeChild(t)}),s("Base layer styles are applied when no custom classes are provided",async()=>{let t=e(r,{});await a({component:t,testCases:[]});let s=document.querySelector('[data-testid="cookie-banner-card"]'),n=document.querySelector('[data-testid="cookie-banner-title"]');if(!s||!n)throw Error("Required elements not found in the document");o(getComputedStyle(s).backgroundColor).toBe("rgb(255, 255, 255)"),o(getComputedStyle(n).color).toBe("rgb(23, 23, 23)")}),s("Multiple custom classes can be applied and override base layer",async()=>{let t=document.createElement("style");t.textContent=`
		.custom-padding {
			padding: 32px !important;
		}
		.custom-border {
			border: 2px solid rgb(0, 0, 255) !important;
		}
	`,document.head.appendChild(t);let s=e(r,{theme:{"banner.card":"custom-padding custom-border"}});await a({component:s,testCases:[{testId:"cookie-banner-card",styles:"custom-padding custom-border"}]});let n=document.querySelector('[data-testid="cookie-banner-card"]');if(!n)throw Error("Required elements not found in the document");o(getComputedStyle(n).padding).toBe("32px"),o(getComputedStyle(n).border).toBe("2px solid rgb(0, 0, 255)"),document.head.removeChild(t)}),s("All cookie banner components should have their base classes applied",async()=>{let t=e(r,{}),s={root:l.root||"",card:l.card||"",header:l.header||"",title:l.title||"",description:l.description||"",footer:l.footer||"",footerSubGroup:l.footerSubGroup||"",rejectButton:`${c.button} ${c["button-small"]} ${c["button-neutral-stroke"]}`,acceptButton:`${c.button} ${c["button-small"]} ${c["button-neutral-stroke"]}`,customizeButton:`${c.button} ${c["button-small"]} ${c["button-primary-stroke"]}`};for(let[e,n]of(await a({component:t,testCases:[{testId:"cookie-banner-root",styles:s.root},{testId:"cookie-banner-card",styles:s.card},{testId:"cookie-banner-header",styles:s.header},{testId:"cookie-banner-title",styles:s.title},{testId:"cookie-banner-description",styles:s.description},{testId:"cookie-banner-footer",styles:s.footer},{testId:"cookie-banner-footer-sub-group",styles:s.footerSubGroup},{testId:"cookie-banner-reject-button",styles:s.rejectButton},{testId:"cookie-banner-customize-button",styles:s.customizeButton},{testId:"cookie-banner-accept-button",styles:s.acceptButton}]}),Object.entries(s)))o(n,`Base class for ${e} should not be empty`).not.toBe("")}),s("should apply correct styles when text direction is RTL",async()=>{let t=await import("../../../hooks/use-text-direction.js"),o=n.mocked(t.useTextDirection),s=o.getMockImplementation();o.mockReturnValue("rtl");let c=e(r,{scrollLock:!0,theme:{"banner.root":"custom-root","banner.footer.accept-button":"custom-accept-button"}});await a({component:c,testCases:[{testId:"cookie-banner-root",styles:"custom-root"},{testId:"cookie-banner-accept-button",styles:"custom-accept-button"}]}),s?o.mockImplementation(s):o.mockReturnValue("ltr")});