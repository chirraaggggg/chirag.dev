import{afterEach as e,beforeEach as t,describe as n,expect as s,test as c,vi as o}from"vitest";import{renderHook as a}from"vitest-browser-react";import{useColorScheme as m}from"../use-color-scheme.js";n("useColorScheme",()=>{let n,d,r;t(()=>{document.documentElement.classList.remove("c15t-dark","dark"),n={matches:!1,addEventListener:o.fn(),removeEventListener:o.fn(),addListener:o.fn(),removeListener:o.fn(),dispatchEvent:o.fn(),onchange:null,media:"(prefers-color-scheme: dark)"},o.spyOn(window,"matchMedia").mockImplementation(()=>n),d=o.spyOn(n,"addEventListener"),r=o.spyOn(n,"removeEventListener")}),e(()=>{o.restoreAllMocks()}),c("sets light theme correctly",()=>{a(()=>m("light")),s(document.documentElement.classList.contains("c15t-dark")).toBe(!1)}),c("sets dark theme correctly",()=>{a(()=>m("dark")),s(document.documentElement.classList.contains("c15t-dark")).toBe(!0)}),c("responds to system preference",()=>{n.matches=!0,a(()=>m("system")),s(document.documentElement.classList.contains("c15t-dark")).toBe(!0),s(d).toHaveBeenCalledWith("change",s.any(Function))}),c("cleans up system preference listener on unmount",()=>{let{unmount:e}=a(()=>m("system"));e(),s(r).toHaveBeenCalled()}),c("updates theme when system preference changes",()=>{a(()=>m("system"));let e=d.mock.calls,t=e[0]?.[1];if(!t)throw Error("Callback not found");t({matches:!0}),s(document.documentElement.classList.contains("c15t-dark")).toBe(!0)}),c("handles default theme based on document class",()=>{document.documentElement.classList.add("dark"),a(()=>m(null)),s(document.documentElement.classList.contains("c15t-dark")).toBe(!0)}),c("updates theme when default theme changes",async()=>{a(()=>m(null)),document.documentElement.classList.add("dark"),await new Promise(e=>setTimeout(e,0)),s(document.documentElement.classList.contains("c15t-dark")).toBe(!0)})});