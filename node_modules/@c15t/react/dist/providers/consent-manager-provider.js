'use client';
import{jsx as e}from"react/jsx-runtime";import{configureConsentManager as n,createConsentManagerStore as o}from"c15t";import{startTransition as t,useEffect as r,useMemo as i,useRef as a,useState as s}from"react";import{ConsentStateContext as c}from"../context/consent-manager-context.js";import{GlobalThemeContext as l}from"../context/theme-context.js";import{useColorScheme as g}from"../hooks/use-color-scheme.js";import{version as d}from"../version.js";let f=new Map,u=new Map;function m(){f.clear(),u.clear()}function p({children:m,options:p}){let{mode:C,backendURL:b,store:k={},translations:v,react:w={}}=p,{theme:h,disableAnimation:L=!1,scrollLock:x=!1,trapFocus:M=!0,colorScheme:H,noStyle:j=!1}=w,T=i(()=>"undefined"!=typeof window&&!!(("c15t"===C||"offline"===C)&&(b?.includes("c15t.dev")||b?.includes("c15t.cloud")||window.location.hostname.includes("c15t.dev")||window.location.hostname.includes("c15t.cloud"))),[C,b]),$=function({mode:e,backendURL:n,endpointHandlers:o,storageConfig:t,enabled:r}){return`${e}:${n??"default"}:${o?"custom":"none"}:${t?.storageKey??"default"}:${!1===r?"disabled":"enabled"}`}({mode:C||"c15t",backendURL:b||"/api/c15t",endpointHandlers:"endpointHandlers"in p?p.endpointHandlers:void 0,storageConfig:p.storageConfig,enabled:p.enabled}),G=i(()=>{let e,o=u.get($);return o||(e="offline"===C?n({mode:"offline",store:k,storageConfig:p.storageConfig}):"custom"===C&&"endpointHandlers"in p?n({mode:"custom",endpointHandlers:p.endpointHandlers,store:k,storageConfig:p.storageConfig}):n({mode:"c15t",backendURL:b||"/api/c15t",store:k,storageConfig:p.storageConfig}),u.set($,e),e)},[$,C,b,k,p]),y=i(()=>{let e=f.get($);if(e)return e;let n=o(G,{unstable_googleTagManager:p.unstable_googleTagManager,config:{pkg:"@c15t/react",version:d,mode:C||"Unknown"},enabled:p.enabled,ignoreGeoLocation:p.ignoreGeoLocation,initialGdprTypes:p.consentCategories,callbacks:p.callbacks,trackingBlockerConfig:p.trackingBlockerConfig,scripts:p.scripts,legalLinks:p.legalLinks,storageConfig:p.storageConfig,user:p.user,overrides:p.overrides,...k,isConsentDomain:T,initialTranslationConfig:v});return f.set($,n),n},[$,G,C,p.callbacks,p.unstable_googleTagManager,p.ignoreGeoLocation,p.consentCategories,p.trackingBlockerConfig,p.scripts,p.legalLinks,p.user,p.overrides,k,T,v,p.storageConfig]),[B,P]=s(()=>y?y.getState():{}),U=a(!1);r(()=>{if(!y)return;let e=y.subscribe(P);if(!U.current){let e=y.getState();t(()=>{P(n=>n!==e?(U.current=!0,e):(U.current=!0,n))})}return e},[y]);let _=i(()=>({theme:h,noStyle:j,disableAnimation:L,scrollLock:x,trapFocus:M,colorScheme:H}),[h,j,L,x,M,H]);g(H);let R=i(()=>{if(!y)throw Error("Consent store must be initialized before creating context value");return{state:B,store:y,manager:G}},[B,y,G]);return e(c.Provider,{value:R,children:e(l.Provider,{value:_,children:m})})}export{p as ConsentManagerProvider,m as clearConsentManagerCache};