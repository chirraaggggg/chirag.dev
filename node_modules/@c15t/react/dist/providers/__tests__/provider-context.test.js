import{jsx as e,jsxs as t}from"react/jsx-runtime";import{defaultTranslationConfig as n}from"c15t";import{afterEach as o,beforeEach as r,describe as s,expect as a,it as i,vi as l}from"vitest";import{render as c}from"vitest-browser-react";import{useConsentManager as u}from"../../hooks/use-consent-manager.js";import{ConsentManagerProvider as m,clearConsentManagerCache as d}from"../consent-manager-provider.js";import{setupMocks as p}from"./test-helpers.js";let{mockConfigureConsentManager:h}=p();l.mock("c15t",async()=>({...await l.importActual("c15t"),configureConsentManager:e=>(h(e),{showConsentBanner:async()=>({ok:!0,data:{showConsentBanner:!0,jurisdiction:{code:"GDPR"},translations:{language:"en",translations:n.translations.en}},error:null,response:null}),setConsent:async()=>({ok:!0,data:{success:!0},error:null,response:null}),verifyConsent:async()=>({ok:!0,data:{valid:!0},error:null,response:null})})}));let g=l.fn();l.mock("../../hooks/use-consent-manager",async()=>{let e=await l.importActual("../../hooks/use-consent-manager");return{...e,useConsentManager:()=>{let t=e.useConsentManager();return t.showPopup=!0,g(),t}}}),s("ConsentManagerProvider Context Values",()=>{r(()=>{l.resetAllMocks(),l.useFakeTimers(),d()}),o(()=>{l.clearAllMocks(),l.useRealTimers()}),i("should provide correct context values to children",async()=>{let{getByTestId:n}=c(e(m,{options:{mode:"offline",react:{theme:{"banner.root":"dark"}}},children:e(()=>{let n=u();return t("div",{children:[e("div",{"data-testid":"has-manager",children:(!!n.manager).toString()}),e("div",{"data-testid":"show-popup",children:n.showPopup?"true":"false"}),e("div",{"data-testid":"debug-state",children:JSON.stringify({showPopup:n.showPopup})})]})},{})}));await l.runAllTimersAsync(),a(g).toHaveBeenCalled(),await l.waitFor(()=>{a(n("has-manager")).toHaveTextContent("true"),a(n("show-popup")).toHaveTextContent("true")},{timeout:3e3})})});