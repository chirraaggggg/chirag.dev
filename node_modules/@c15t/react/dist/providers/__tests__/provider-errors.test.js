import{jsx as e}from"react/jsx-runtime";import{afterEach as r,beforeEach as n,describe as o,expect as t,it as s,vi as a}from"vitest";import{render as i}from"vitest-browser-react";import{useConsentManager as l}from"../../hooks/use-consent-manager.js";import{ConsentManagerProvider as c}from"../consent-manager-provider.js";import{setupMocks as d}from"./test-helpers.js";let{mockFetch:p}=d();a.mock("c15t",async()=>({...await a.importActual("c15t"),configureConsentManager:e=>{let r=e.backendURL||"";return"c15t"===e.mode&&p(`${r}/show-consent-banner`,{headers:{"Content-Type":"application/json"}}),{showConsentBanner:async()=>({ok:!1,data:null,error:{message:"API error"},response:new Response(JSON.stringify({error:"API error"}),{status:500,headers:{"Content-Type":"application/json"}})}),setConsent:async()=>({ok:!0,data:{success:!0},error:null,response:null}),verifyConsent:async()=>({ok:!0,data:{valid:!0},error:null,response:null})}}})),o("ConsentManagerProvider Error Handling",()=>{n(()=>{a.resetAllMocks(),p.mockResolvedValueOnce(new Response(JSON.stringify({error:"API error"}),{status:500,headers:{"Content-Type":"application/json"}}))}),r(()=>{a.clearAllMocks()}),s("should handle errors from API responses",async()=>{let{getByTestId:r}=i(e(c,{options:{mode:"c15t",backendURL:"/api/c15t"},children:e(()=>e("div",{"data-testid":"request-state",children:l().manager?"Manager Ready":"Manager Not Ready"}),{})}));await a.waitFor(()=>{t(r("request-state")).toHaveTextContent(/Manager (Not )?Ready/)}),t(p).toHaveBeenCalledTimes(1)})});