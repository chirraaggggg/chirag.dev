import { describe, expect, it } from "vitest";
import { levels, shouldPublishLog } from "../../core/levels.js";
describe('log-levels', ()=>{
    describe('levels', ()=>{
        it('should contain all expected log levels', ()=>{
            expect(levels).toContain('error');
            expect(levels).toContain('warn');
            expect(levels).toContain('info');
            expect(levels).toContain('success');
            expect(levels).toContain('debug');
        });
        it('should be defined in correct order for log level comparison', ()=>{
            expect(levels.indexOf('error')).toBeLessThan(levels.indexOf('warn'));
            expect(levels.indexOf('warn')).toBeLessThan(levels.indexOf('info'));
            expect(levels.indexOf('info')).toBeLessThan(levels.indexOf('success'));
            expect(levels.indexOf('success')).toBeLessThan(levels.indexOf('debug'));
        });
    });
    describe('shouldPublishLog', ()=>{
        it('should allow messages with level equal to or more important than the current level', ()=>{
            expect(shouldPublishLog('info', 'info')).toBe(true);
            expect(shouldPublishLog('warn', 'warn')).toBe(true);
            expect(shouldPublishLog('warn', 'error')).toBe(true);
            expect(shouldPublishLog('warn', 'info')).toBe(false);
            expect(shouldPublishLog('error', 'error')).toBe(true);
            expect(shouldPublishLog('error', 'warn')).toBe(false);
            expect(shouldPublishLog('error', 'info')).toBe(false);
            expect(shouldPublishLog('debug', 'debug')).toBe(true);
            expect(shouldPublishLog('debug', 'error')).toBe(true);
            expect(shouldPublishLog('debug', 'warn')).toBe(true);
            expect(shouldPublishLog('debug', 'info')).toBe(true);
            expect(shouldPublishLog('debug', 'success')).toBe(true);
        });
        it('should use array comparison for determining log level priority', ()=>{
            const testFn = (currentLevel, messageLevel)=>{
                const currentLevelIndex = levels.indexOf(currentLevel);
                const messageLevelIndex = levels.indexOf(messageLevel);
                return messageLevelIndex <= currentLevelIndex;
            };
            expect(testFn('info', 'error')).toBe(true);
            expect(testFn('warn', 'error')).toBe(true);
            expect(testFn('error', 'error')).toBe(true);
            expect(testFn('error', 'warn')).toBe(false);
            expect(testFn('info', 'error')).toBe(shouldPublishLog('info', 'error'));
            expect(testFn('warn', 'error')).toBe(shouldPublishLog('warn', 'error'));
            expect(testFn('error', 'error')).toBe(shouldPublishLog('error', 'error'));
            expect(testFn('error', 'warn')).toBe(shouldPublishLog('error', 'warn'));
        });
    });
});
