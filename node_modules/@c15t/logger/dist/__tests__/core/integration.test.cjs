"use strict";
var __webpack_exports__ = {};
const external_neverthrow_namespaceObject = require("neverthrow");
const external_vitest_namespaceObject = require("vitest");
const logger_cjs_namespaceObject = require("../../core/logger.cjs");
const result_cjs_namespaceObject = require("../../utils/result.cjs");
(0, external_vitest_namespaceObject.describe)('logger integration', ()=>{
    (0, external_vitest_namespaceObject.beforeEach)(()=>{
        external_vitest_namespaceObject.vi.spyOn(console, 'log').mockImplementation(()=>{});
        external_vitest_namespaceObject.vi.spyOn(console, 'warn').mockImplementation(()=>{});
        external_vitest_namespaceObject.vi.spyOn(console, 'error').mockImplementation(()=>{});
        external_vitest_namespaceObject.vi.spyOn(console, 'debug').mockImplementation(()=>{});
    });
    (0, external_vitest_namespaceObject.afterEach)(()=>{
        external_vitest_namespaceObject.vi.restoreAllMocks();
    });
    (0, external_vitest_namespaceObject.describe)('full logger pipeline', ()=>{
        (0, external_vitest_namespaceObject.it)('should work with default logger and result logging together', ()=>{
            const logger = (0, logger_cjs_namespaceObject.createLogger)();
            const testError = {
                message: 'Integration test error',
                code: 'INTEGRATION_TEST'
            };
            const errorResult = (0, external_neverthrow_namespaceObject.err)(testError);
            (0, result_cjs_namespaceObject.logResult)(errorResult, logger);
            (0, external_vitest_namespaceObject.expect)(console.error).toHaveBeenCalledTimes(1);
            const mockedConsoleError = external_vitest_namespaceObject.vi.mocked(console.error);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[0]?.[0]).toContain('ERROR');
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[0]?.[0]).toContain('Integration test error');
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[0]?.[1]).toEqual(testError);
        });
        (0, external_vitest_namespaceObject.it)('should work with custom log level and error logging together', ()=>{
            const logger = (0, logger_cjs_namespaceObject.createLogger)({
                level: 'info'
            });
            logger.info('Info message');
            logger.debug('Debug message');
            logger.warn('Warning message');
            (0, external_vitest_namespaceObject.expect)(console.log).toHaveBeenCalledTimes(1);
            (0, external_vitest_namespaceObject.expect)(console.debug).toHaveBeenCalledTimes(0);
            (0, external_vitest_namespaceObject.expect)(console.warn).toHaveBeenCalledTimes(1);
            const testError = {
                message: 'Integration error'
            };
            (0, result_cjs_namespaceObject.logResult)((0, external_neverthrow_namespaceObject.err)(testError), logger);
            (0, external_vitest_namespaceObject.expect)(console.error).toHaveBeenCalledTimes(1);
        });
        (0, external_vitest_namespaceObject.it)('should work with custom log handler and result logging', ()=>{
            const customLogHandler = external_vitest_namespaceObject.vi.fn();
            const logger = (0, logger_cjs_namespaceObject.createLogger)({
                level: 'info',
                log: customLogHandler,
                appName: 'c15t'
            });
            logger.info('Direct info');
            logger.error('Direct error');
            (0, external_vitest_namespaceObject.expect)(customLogHandler).toHaveBeenCalledTimes(2);
            const testError = {
                message: 'Result error'
            };
            (0, result_cjs_namespaceObject.logResult)((0, external_neverthrow_namespaceObject.err)(testError), logger);
            (0, external_vitest_namespaceObject.expect)(customLogHandler).toHaveBeenCalledTimes(3);
            const mockedCustomLogHandler = external_vitest_namespaceObject.vi.mocked(customLogHandler);
            (0, external_vitest_namespaceObject.expect)(mockedCustomLogHandler.mock.calls[2]?.[0]).toBe('error');
            (0, external_vitest_namespaceObject.expect)(mockedCustomLogHandler.mock.calls[2]?.[1]).toBe('Error: Result error');
        });
        (0, external_vitest_namespaceObject.it)('should support async result logging with the logger', async ()=>{
            const logger = (0, logger_cjs_namespaceObject.createLogger)();
            const testError = {
                message: 'Async integration error'
            };
            const errorResultAsync = (0, external_neverthrow_namespaceObject.errAsync)(testError);
            await (0, result_cjs_namespaceObject.logResultAsync)(errorResultAsync, logger).match(()=>{}, ()=>{});
            (0, external_vitest_namespaceObject.expect)(console.error).toHaveBeenCalledTimes(1);
            const mockedConsoleError = external_vitest_namespaceObject.vi.mocked(console.error);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[0]?.[0]).toContain('Async integration error');
        });
        (0, external_vitest_namespaceObject.it)('should use custom application name in logs', ()=>{
            const customAppName = 'c15t-api';
            const logger = (0, logger_cjs_namespaceObject.createLogger)({
                level: 'info',
                appName: customAppName
            });
            logger.info('Application started');
            logger.warn('Configuration incomplete');
            logger.error('Failed to connect to database');
            const mockedConsoleLog = external_vitest_namespaceObject.vi.mocked(console.log);
            const mockedConsoleWarn = external_vitest_namespaceObject.vi.mocked(console.warn);
            const mockedConsoleError = external_vitest_namespaceObject.vi.mocked(console.error);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleLog.mock.calls[0]?.[0]).toContain(`[${customAppName}]`);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleWarn.mock.calls[0]?.[0]).toContain(`[${customAppName}]`);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[0]?.[0]).toContain(`[${customAppName}]`);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleLog.mock.calls[0]?.[0]).not.toContain('[c15t]');
            const testError = {
                message: 'Integration error with custom app name'
            };
            (0, result_cjs_namespaceObject.logResult)((0, external_neverthrow_namespaceObject.err)(testError), logger);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[1]?.[0]).toContain(`[${customAppName}]`);
            (0, external_vitest_namespaceObject.expect)(mockedConsoleError.mock.calls[1]?.[0]).toContain('Integration error with custom app name');
        });
    });
});
for(var __webpack_i__ in __webpack_exports__)exports[__webpack_i__] = __webpack_exports__[__webpack_i__];
Object.defineProperty(exports, '__esModule', {
    value: true
});
