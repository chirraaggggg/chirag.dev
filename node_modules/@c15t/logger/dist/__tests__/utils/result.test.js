import { err, errAsync, ok, okAsync } from "neverthrow";
import { describe, expect, it, vi } from "vitest";
import { logResult, logResultAsync } from "../../utils/result.js";
describe('result-logging', ()=>{
    describe('logResult', ()=>{
        it('should log error from a Result and return the original Result', ()=>{
            const logger = {
                error: vi.fn()
            };
            const testError = {
                message: 'Test error',
                code: 'TEST_ERROR',
                status: 400,
                meta: {
                    test: true
                },
                category: 'test',
                stack: 'Error stack'
            };
            const errorResult = err(testError);
            const result = logResult(errorResult, logger);
            expect(logger.error).toHaveBeenCalledTimes(1);
            expect(logger.error).toHaveBeenCalledWith('Error: Test error', testError);
            expect(result).toStrictEqual(errorResult);
            result.mapErr((error)=>{
                expect(error).toEqual(testError);
                return error;
            });
        });
        it('should not log anything for a successful Result', ()=>{
            const logger = {
                error: vi.fn()
            };
            const successResult = ok('Success');
            const result = logResult(successResult, logger);
            expect(logger.error).not.toHaveBeenCalled();
            expect(result).toStrictEqual(successResult);
        });
        it('should use custom message prefix when provided', ()=>{
            const logger = {
                error: vi.fn()
            };
            const testError = {
                message: 'Test error'
            };
            const errorResult = err(testError);
            logResult(errorResult, logger, 'Custom prefix:');
            expect(logger.error).toHaveBeenCalledWith('Custom prefix: Test error', expect.any(Object));
        });
        it('should handle errors with minimal properties', ()=>{
            const logger = {
                error: vi.fn()
            };
            const minimalError = {
                message: 'Minimal error'
            };
            const errorResult = err(minimalError);
            logResult(errorResult, logger);
            expect(logger.error).toHaveBeenCalledWith('Error: Minimal error', minimalError);
        });
    });
    describe('logResultAsync', ()=>{
        it('should log error from a ResultAsync and return the original ResultAsync', async ()=>{
            const logger = {
                error: vi.fn()
            };
            const testError = {
                message: 'Async test error',
                code: 'ASYNC_TEST_ERROR',
                status: 500
            };
            const errorResultAsync = errAsync(testError);
            const resultAsync = logResultAsync(errorResultAsync, logger);
            await resultAsync.match(()=>{}, ()=>{});
            expect(logger.error).toHaveBeenCalledTimes(1);
            expect(logger.error).toHaveBeenCalledWith('Error: Async test error', testError);
        });
        it('should not log anything for a successful ResultAsync', async ()=>{
            const logger = {
                error: vi.fn()
            };
            const successResultAsync = okAsync('Async Success');
            const resultAsync = logResultAsync(successResultAsync, logger);
            await resultAsync.match(()=>{}, ()=>{});
            expect(logger.error).not.toHaveBeenCalled();
        });
        it('should use custom message prefix for async errors', async ()=>{
            const logger = {
                error: vi.fn()
            };
            const testError = {
                message: 'Async error'
            };
            const errorResultAsync = errAsync(testError);
            const resultAsync = logResultAsync(errorResultAsync, logger, 'Async error:');
            await resultAsync.match(()=>{}, ()=>{});
            expect(logger.error).toHaveBeenCalledWith('Async error: Async error', expect.any(Object));
        });
    });
});
