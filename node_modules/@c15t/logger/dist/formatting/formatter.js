import picocolors from "picocolors";
const formatters = {};
const defaultFormatter = (level, message, args, appName = 'c15t')=>{
    const now = new Date();
    const timestamp = `${now.toTimeString().split(' ')[0]}.${now.getMilliseconds().toString().padStart(3, '0')}`;
    const formattedArgs = formatArgs(args);
    let levelBadge;
    switch(level){
        case 'error':
            levelBadge = picocolors.bgRed(picocolors.black(` ${level.toUpperCase()} `));
            break;
        case 'warn':
            levelBadge = picocolors.bgYellow(picocolors.black(` ${level.toUpperCase()} `));
            break;
        case 'info':
            levelBadge = picocolors.bgBlue(picocolors.white(` ${level.toUpperCase()} `));
            break;
        case 'debug':
            levelBadge = picocolors.bgBlack(picocolors.white(` ${level.toUpperCase()} `));
            break;
        case 'success':
            levelBadge = picocolors.bgGreen(picocolors.black(` ${level.toUpperCase()} `));
            break;
        default:
            levelBadge = picocolors.bold(`[${String(level).toUpperCase()}]`);
            break;
    }
    return `${picocolors.gray(timestamp)} ${levelBadge} ${picocolors.bold(`[${appName}]`)} ${message}${formattedArgs}`;
};
const formatArgs = (args)=>{
    if (0 === args.length) return '';
    return `\n${args.map((arg)=>{
        if (null === arg) return '  - null';
        if (void 0 === arg) return '  - undefined';
        try {
            if (arg instanceof Error) return `  - ${arg.name}: ${arg.message}\n    ${arg.stack || ''}`;
            return `  - ${JSON.stringify(arg, null, 2).replace(/\n/g, '\n    ')}`;
        } catch  {
            return `  - [Object: ${Object.prototype.toString.call(arg)}]`;
        }
    }).join('\n')}`;
};
const nextjsFormatter = (level, message, args, appName = 'c15t')=>{
    const now = new Date();
    const timestamp = `${now.toTimeString().split(' ')[0]}.${now.getMilliseconds().toString().padStart(3, '0')}`;
    const formattedArgs = formatArgs(args);
    const levelMarker = `[${level.toUpperCase()}]`;
    const appMarker = `[${appName}]`;
    return `${timestamp} ${levelMarker} ${appMarker} ${message}${formattedArgs}`;
};
formatters.default = defaultFormatter;
formatters.nextjs = nextjsFormatter;
const registerFormatter = (name, formatter)=>{
    formatters[name] = formatter;
};
const getFormatter = (name = 'default')=>formatters[name] || defaultFormatter;
const formatMessage = (level, message, args = [], formatterName = 'default', appName)=>{
    const formatter = getFormatter(formatterName);
    return formatter(level, message, args, appName);
};
export { formatArgs, formatMessage, getFormatter, nextjsFormatter, registerFormatter };
