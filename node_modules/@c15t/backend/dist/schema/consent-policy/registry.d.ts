import type { GenericEndpointContext, RegistryContext } from '../../pkgs/types';
import type { ConsentPolicy, PolicyType } from './schema';
/**
 * Creates and returns a set of consent policy-related adapter methods to interact with the database.
 * These methods provide a consistent interface for creating, finding, and updating
 * consent policy records while applying hooks and enforcing data validation rules.
 *
 * The returned registry object contains methods for common operations on consent policies,
 * including creation, retrieval, and conditional creation. All methods validate their
 * inputs and outputs according to the schema configuration.
 *
 * @param params - Registry context parameters
 * @param params.adapter - The database adapter used for direct database operations
 * @param params.ctx - Additional context properties containing hooks and options
 * @returns An object containing type-safe consent policy operations
 *
 * @example
 * ```typescript
 * const registry = policyRegistry({
 *   adapter: databaseAdapter,
 *   hooks: customHooks,
 *   options: validationOptions
 * });
 *
 * // Use the registry methods
 * const policy = await registry.findOrCreatePolicy('privacy');
 * ```
 *
 * @see {@link RegistryContext} For details on the context parameters
 * @see {@link ConsentPolicy} For the structure of policy objects
 */
export declare function policyRegistry({ adapter, ...ctx }: RegistryContext): {
    /**
     * Creates a new consent policy record in the database.
     * Automatically sets creation timestamp and applies any
     * configured hooks during the creation process.
     *
     * This method validates the provided policy data, assigns a creation timestamp,
     * and stores it in the database. It uses the configured hooks system to allow
     * for customization of the creation process.
     *
     * @param policy - Policy data to create (without id and timestamp)
     * @param context - Optional endpoint context for hooks execution
     * @returns Promise resolving to the created policy with all fields populated
     * @throws {Error} When the creation operation fails or returns null
     * @throws May also throw errors if hooks prevent creation or if database operations fail
     *
     * @example
     * ```ts
     * const newPolicy = await policyRegistry.createConsentPolicy({
     *   version: '1.0.0',
     *   type: 'privacy',
     *   name: 'Privacy Policy',
     *   effectiveDate: new Date(),
     *   content: 'Full policy text...',
     *   contentHash: 'sha256-hash-of-content',
     *   isActive: true,
     *   updatedAt: new Date(),
     *   expirationDate: null
     * });
     * ```
     *
     * @see {@link ConsentPolicy} For the structure of the policy object
     * @see {@link GenericEndpointContext} For details on the context object
     */
    createConsentPolicy: (policy: Omit<ConsentPolicy, "id" | "createdAt"> & Partial<ConsentPolicy>, context?: GenericEndpointContext) => Promise<{
        id: string;
        version: string;
        type: "cookie_banner" | "privacy_policy" | "dpa" | "terms_and_conditions" | "marketing_communications" | "age_verification" | "other";
        name: string;
        effectiveDate: Date;
        content: string;
        contentHash: string;
        isActive: boolean;
        createdAt: Date;
        updatedAt: Date;
        expirationDate?: Date | null | undefined;
    }>;
    /**
     * Retrieves consent policies from the database based on provided filter parameters.
     *
     * This method queries the database for consent policies matching the specified criteria.
     * By default, only active policies are returned unless specifically requested otherwise.
     * Results are sorted by effective date in descending order (newest first).
     *
     * @param params - Optional parameters to filter the policies
     * @param params.domainId - Optional domain identifier to filter policies by domain
     * @param params.version - Optional version string to filter policies by specific version
     * @param params.includeInactive - When true, includes inactive policies in the results
     * @returns Promise resolving to an array of validated consent policy objects
     *
     * @example
     * ```ts
     * // Get all active policies
     * const activePolicies = await policyRegistry.findPolicies();
     *
     * // Get all policies including inactive ones
     * const allPolicies = await policyRegistry.findPolicies({ includeInactive: true });
     *
     * // Get active policies for a specific version
     * const specificVersionPolicies = await policyRegistry.findPolicies({
     *   version: '2.0.0'
     * });
     * ```
     *
     * @see {@link ConsentPolicy} For the structure of returned policy objects
     */
    findPolicies: (params?: {
        domainId?: string;
        version?: string;
        includeInactive?: boolean;
    }) => Promise<{
        id: string;
        version: string;
        type: "cookie_banner" | "privacy_policy" | "dpa" | "terms_and_conditions" | "marketing_communications" | "age_verification" | "other";
        name: string;
        effectiveDate: Date;
        content: string;
        contentHash: string;
        isActive: boolean;
        createdAt: Date;
        updatedAt: Date;
        expirationDate?: Date | null | undefined;
    }[]>;
    /**
     * Finds a consent policy by its unique ID.
     * Returns the policy with processed output fields according to the schema configuration.
     *
     * This method queries the database for a single consent policy that matches the provided ID.
     * The resulting policy is validated against the schema before being returned.
     *
     * @param policyId - The unique identifier of the policy to find
     * @returns Promise resolving to the validated policy object if found, null otherwise
     *
     * @example
     * ```ts
     * // Find a policy by ID
     * const policy = await policyRegistry.findConsentPolicyById('policy-123');
     * if (policy) {
     *   console.log(`Found policy: ${policy.name}, version ${policy.version}`);
     * } else {
     *   console.log('Policy not found');
     * }
     * ```
     *
     * @see {@link ConsentPolicy} For the structure of the returned policy object
     */
    findConsentPolicyById: (policyId: string) => Promise<{
        id: string;
        version: string;
        type: "cookie_banner" | "privacy_policy" | "dpa" | "terms_and_conditions" | "marketing_communications" | "age_verification" | "other";
        name: string;
        effectiveDate: Date;
        content: string;
        contentHash: string;
        isActive: boolean;
        createdAt: Date;
        updatedAt: Date;
        expirationDate?: Date | null | undefined;
    } | null>;
    /**
     * Finds the latest active policy or creates a new one if none exists.
     * Uses a database transaction to prevent race conditions in multi-threaded environments.
     *
     * If multiple active policies with the same type exist, returns the most recent one
     * based on effectiveDate. When creating a new policy, it assigns version '1.0.0'
     * and generates placeholder content with a SHA-256 hash.
     *
     * @param type - The type of the policy to find/create (e.g., 'privacy', 'terms')
     * @returns Promise resolving to the found or newly created policy object
     * @throws {Error} If the database transaction fails to complete
     *
     * @example
     * ```ts
     * // Find or create a privacy policy
     * const privacyPolicy = await policyRegistry.findOrCreatePolicy('privacy');
     *
     * // Find or create a terms of service policy
     * const termsPolicy = await policyRegistry.findOrCreatePolicy('terms');
     * ```
     *
     * @see {@link PolicyType} For the available policy types
     * @see {@link ConsentPolicy} For the structure of the returned policy object
     * @see {@link generatePolicyPlaceholder} For details on how placeholder content is generated
     */
    findOrCreatePolicy: (type: PolicyType) => Promise<{
        id: string;
        version: string;
        type: "cookie_banner" | "privacy_policy" | "dpa" | "terms_and_conditions" | "marketing_communications" | "age_verification" | "other";
        name: string;
        effectiveDate: Date;
        content: string;
        contentHash: string;
        isActive: boolean;
        createdAt: Date;
        updatedAt: Date;
        expirationDate?: Date | null | undefined;
    }>;
};
//# sourceMappingURL=registry.d.ts.map