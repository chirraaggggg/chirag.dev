// src/schema/name-variants-builder.ts
function createNameVariantsBuilder(namespace, schemas, out) {
  const names = (...args) => {
    let updated;
    if (args.length === 2) {
      const [versions, variants] = args;
      updated = schemas.flatMap((schema) => {
        if (!versions.includes(schema.version)) return [];
        return applyNameVariants(schema, variants);
      });
    } else {
      const [variants] = args;
      updated = schemas.map((schema) => applyNameVariants(schema, variants));
    }
    return out(updated);
  };
  names.prefix = (prefix) => {
    if (prefix === true) prefix = namespace;
    return out(
      schemas.map(
        (schema) => applyNameVariantsPrefix(schema, prefix)
      )
    );
  };
  return names;
}
function applyNameVariantsPrefix(schema, prefix) {
  const generated = {};
  for (const [tableName, table] of Object.entries(schema.tables)) {
    const names = {};
    for (const [k, v] of Object.entries(table.names)) {
      names[k] = prefix + v;
    }
    generated[tableName] = names;
  }
  return applyNameVariants(schema, generated);
}
function applyNameVariants(schema, names) {
  const cloned = schema.clone();
  for (const [k, v] of Object.entries(names)) {
    if (v === void 0) continue;
    const [tableName, colName] = k.split(".", 2);
    const table = cloned.tables[tableName];
    if (!table) continue;
    if (!colName) {
      table.names = {
        ...table.names,
        ...v
      };
      continue;
    }
    const col = table.columns[colName];
    if (!col) continue;
    col.names = { ...col.names, ...v };
  }
  return cloned;
}

export {
  createNameVariantsBuilder,
  applyNameVariants
};
